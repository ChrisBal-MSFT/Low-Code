"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1057],{4137:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>k});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var p=o.createContext({}),s=function(e){var t=o.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=s(e.components);return o.createElement(p.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},u=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,p=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),d=s(n),u=a,k=d["".concat(p,".").concat(u)]||d[u]||c[u]||r;return n?o.createElement(k,i(i({ref:t},m),{},{components:n})):o.createElement(k,i({ref:t},m))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=u;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l[d]="string"==typeof e?e:a,i[1]=l;for(var s=2;s<r;s++)i[s]=n[s];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}u.displayName="MDXCreateElement"},6624:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>l,toc:()=>s});var o=n(7462),a=(n(7294),n(4137));const r={sidebar_position:1,title:"2. Implement Component Logic"},i=void 0,l={unversionedId:"prodev-3/step-2",id:"prodev-3/step-2",title:"2. Implement Component Logic",description:"Working as part of the PrioritZ fusion team you have been asked to create a Power Apps code component to allow drag and drop priority ranking of items in the PrioritZ Ask Power App.",source:"@site/docs/prodev-3/step-2.md",sourceDirName:"prodev-3",slug:"/prodev-3/step-2",permalink:"/Low-Code/docs/prodev-3/step-2",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"2. Implement Component Logic"},sidebar:"tutorialSidebar",previous:{title:"1. Build Code Component",permalink:"/Low-Code/docs/prodev-3/step-1"},next:{title:"3. Use Code Component",permalink:"/Low-Code/docs/prodev-3/step-3"}},p={},s=[{value:"2.1 Implement the component logic",id:"21-implement-the-component-logic",level:2},{value:"2.2 Run the command and test harness",id:"22-run-the-command-and-test-harness",level:2},{value:"2.3 Push component to your environment",id:"23-push-component-to-your-environment",level:2}],m={toc:s};function d(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("admonition",{title:"LAB SCENARIO",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Working as part of the PrioritZ fusion team you have been asked to create a Power Apps code component to allow drag and drop priority ranking of items in the PrioritZ Ask Power App.\nYou will build a code component using the React JavaScript framework.\nThe code component approach is used to address the requirement because there isn\u2019t a similar control already built-in."),(0,a.kt)("p",{parentName:"admonition"},"You have collaborated with the app makers to identify the following properties to allow them to configure the code component in the app:"),(0,a.kt)("p",{parentName:"admonition"},"\u2022\tBackgroundColor"),(0,a.kt)("p",{parentName:"admonition"},"\u2022\tDragBackgroundColor"),(0,a.kt)("p",{parentName:"admonition"},"\u2022\tItemHeight"),(0,a.kt)("p",{parentName:"admonition"},"\u2022\tFontSize"),(0,a.kt)("p",{parentName:"admonition"},"\u2022\tFontColor"),(0,a.kt)("p",{parentName:"admonition"},"The PrioritZ Ask app will prepare a collection of the items to rank that will be bound as the dataset for the code component.",(0,a.kt)("br",{parentName:"p"}),"\n","When an item is dragged and dropped the code component will raise an OnSelect event that will be handled by the hosting app.",(0,a.kt)("br",{parentName:"p"}),"\n","The hosting app will update the collection items with their new rank.  The code component will be stateless."),(0,a.kt)("p",{parentName:"admonition"},"In ",(0,a.kt)("strong",{parentName:"p"},"Exercise 2")," you will implement the component logic.")),(0,a.kt)("h2",{id:"21-implement-the-component-logic"},"2.1 Implement the component logic"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Delete the ",(0,a.kt)("inlineCode",{parentName:"p"},"HelloWorld.tsx")," component file that is automatically created as we won\u2019t be using it.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Go to the lab resources folder.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Drag the ",(0,a.kt)("inlineCode",{parentName:"p"},"PriorityComponent.tsx")," file and drop it in the ",(0,a.kt)("inlineCode",{parentName:"p"},"PrioriZDnDRanking")," folder.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\ud83e\udd16 Note: The ",(0,a.kt)("inlineCode",{parentName:"p"},"PriorityComponent.tsx")," file should now be in the ",(0,a.kt)("inlineCode",{parentName:"p"},"PrioriZDnDRanking")," folder.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Click ",(0,a.kt)("strong",{parentName:"p"},"File")," and save your changes.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Open the ",(0,a.kt)("inlineCode",{parentName:"p"},"PriorityComponent.tsx")," and review the contents.  This implements the React component that will be rendered to represent our draggable items.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\ud83e\udd16 Note: Notice line 9 from ",(0,a.kt)("inlineCode",{parentName:"p"},"\u2018react-beautiful-dnd\u2019")," has a red underline.  This is a npm package the component uses that we haven\u2019t referenced."))),(0,a.kt)("ol",{start:8},(0,a.kt)("li",{parentName:"ol"},"Run the following command in a terminal window to add a reference to react-beautiful-dnd")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"npm install react-beautiful-dnd\n")),(0,a.kt)("ol",{start:9},(0,a.kt)("li",{parentName:"ol"},"Add the following command for the type definitions.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"npm install --save-dev @types/react-beautiful-dnd\n")),(0,a.kt)("ol",{start:10},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Notice the red underline in line 9 has been resolved.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Open the ",(0,a.kt)("inlineCode",{parentName:"p"},"index.ts")," file.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Remove ",(0,a.kt)("inlineCode",{parentName:"p"},"line 2")," as we are no longer using ",(0,a.kt)("inlineCode",{parentName:"p"},"HelloWorld"),"."))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'import { HelloWorld, IHelloWorldProps } from "./HelloWorld";\n')),(0,a.kt)("ol",{start:13},(0,a.kt)("li",{parentName:"ol"},"Add the import below to the ",(0,a.kt)("inlineCode",{parentName:"li"},"index.ts")," file. This will reference the ",(0,a.kt)("inlineCode",{parentName:"li"},"PriorityComponent"),".")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"import { PriorityComponent, PriorityComponentProps } from './PriorityComponent';\n")),(0,a.kt)("ol",{start:14},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Locate the ",(0,a.kt)("inlineCode",{parentName:"p"},"Export")," class line in ",(0,a.kt)("inlineCode",{parentName:"p"},"index.ts"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Add the following code below inside the export class. This defines some working variables you will be using in the workshop logic."))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"private context: ComponentFramework.Context<IInputs>;\nprivate items: ComponentFramework.PropertyTypes.DataSet;\n")),(0,a.kt)("ol",{start:16},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Locate the ",(0,a.kt)("inlineCode",{parentName:"p"},"init")," function.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Paste the code below inside the ",(0,a.kt)("inlineCode",{parentName:"p"},"init")," function. This logic initializes our class variables from the runtime values and enables resize notification."))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"this.context = context;\ncontext.mode.trackContainerResize(true);\n")),(0,a.kt)("ol",{start:18},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Locate the ",(0,a.kt)("inlineCode",{parentName:"p"},"updateView")," function.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Replace the ",(0,a.kt)("inlineCode",{parentName:"p"},"updateView")," function with the function below. This logic creates the ",(0,a.kt)("inlineCode",{parentName:"p"},"React Element")," from the ",(0,a.kt)("inlineCode",{parentName:"p"},"PriorityComponent")," and adds it to the virtual DOM."))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"public updateView(context: ComponentFramework.Context<IInputs>): React.ReactElement {\n        const dataset = context.parameters.items;\n        return React.createElement(PriorityComponent, {\n            width: context.mode.allocatedWidth,\n            height: context.mode.allocatedHeight,\n            itemHeight: context.parameters.ItemHeight.raw,\n            fontSize: context.parameters.FontSize.raw,\n            fontColor: context.parameters.FontColor.raw,\n            dataset: dataset,\n            onReorder: this.onReorder,\n            backgroundColor: this.context.parameters.BackgroundColor.raw,\n            dragBackgroundColor: this.context.parameters.DragBackgroundColor.raw,\n        } as PriorityComponentProps);\n    }\n")),(0,a.kt)("ol",{start:20},(0,a.kt)("li",{parentName:"ol"},"Add the function below after the destroy function. This logic handles the ",(0,a.kt)("inlineCode",{parentName:"li"},"onReorder")," event from the ",(0,a.kt)("inlineCode",{parentName:"li"},"PriorityComponent")," and lidentifies the involved items to the hosting app as selected items.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"onReorder = (sourceIndex: number, destinationIndex: number): void => {\n        const dataset = this.context.parameters.items;\n        const sourceId = dataset.sortedRecordIds[sourceIndex];\n        const destinationId = dataset.sortedRecordIds[destinationIndex];\n        // raise the OnSelect event\n        this.context.parameters.items.openDatasetItem(dataset.records[sourceId].getNamedReference());\n        // set the SelectedItems property\n        this.context.parameters.items.setSelectedRecordIds([sourceId, destinationId]);\n    };\n")),(0,a.kt)("ol",{start:21},(0,a.kt)("li",{parentName:"ol"},"Open the ",(0,a.kt)("inlineCode",{parentName:"li"},"package.json")," file."),(0,a.kt)("li",{parentName:"ol"},"Locate the ",(0,a.kt)("inlineCode",{parentName:"li"},"dependencies")," JSON object."),(0,a.kt)("li",{parentName:"ol"},"Replace ",(0,a.kt)("inlineCode",{parentName:"li"},"dependencies")," with the JSON below.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'"dependencies": {\n    "@fluentui/react": "8.29.0",\n    "eslint-config-prettier": "^8.5.0",\n    "eslint-plugin-prettier": "^4.0.0",\n    "eslint-plugin-react": "^7.29.4",\n    "eslint-plugin-react-hooks": "^4.4.0",\n    "eslint-plugin-sonarjs": "^0.13.0",\n    "prettier": "^2.6.1",\n    "react": "16.8.6",\n    "react-beautiful-dnd": "^13.1.0",\n    "react-dom": "16.8.6"\n  },\n')),(0,a.kt)("ol",{start:24},(0,a.kt)("li",{parentName:"ol"},"Make the following modification to the file ",(0,a.kt)("inlineCode",{parentName:"li"},".eslintrc.json")," to work around a new lint rule that was too strict.\na)\tOpen the ",(0,a.kt)("inlineCode",{parentName:"li"},".eslintrc.json")," file.\nb)\tLocate rules and paste the rules below.")),(0,a.kt)("ol",{start:25},(0,a.kt)("li",{parentName:"ol"},"Click ",(0,a.kt)("strong",{parentName:"li"},"File")," and save all your changes.")),(0,a.kt)("h2",{id:"22-run-the-command-and-test-harness"},"2.2 Run the command and test harness"),(0,a.kt)("ol",{start:26},(0,a.kt)("li",{parentName:"ol"},"Go to the terminal and run the command below. This will build your component and identify any problems.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"npm run-script build\n")),(0,a.kt)("ol",{start:27},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"\ud83e\udd16 Note: The build should succeed. If any errors, resolve them before proceeding.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Run the command below to start the test harness."))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"npm start\n")),(0,a.kt)("ol",{start:29},(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"The test harness should start. Try dragging the items and see if the behavior functions as expected. The data shown will be the default test harness data.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Close the test harness.")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Stop the run by holding the ",(0,a.kt)("inlineCode",{parentName:"p"},"CONTROL")," key + C. ")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Type Y and ",(0,a.kt)("inlineCode",{parentName:"p"},"ENTER"),".")),(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Run the command below to see your currently selected environment."))),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"pac org who\n")),(0,a.kt)("ol",{start:26},(0,a.kt)("li",{parentName:"ol"},"\ud83e\udd16 Note: You should have the dev environment you created selected. If not, run the select command from the end of lab one again.")),(0,a.kt)("h2",{id:"23-push-component-to-your-environment"},"2.3 Push component to your environment"),(0,a.kt)("ol",{start:27},(0,a.kt)("li",{parentName:"ol"},"Run the command below to push the component to your environment.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"pac pcf push --publisher-prefix contoso\n")),(0,a.kt)("ol",{start:28},(0,a.kt)("li",{parentName:"ol"},"Wait for the solution to be imported and published to your environment.")))}d.isMDXComponent=!0}}]);