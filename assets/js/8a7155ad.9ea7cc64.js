"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9644],{4137:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>f});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),p=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return o.createElement(s.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(n),d=r,f=c["".concat(s,".").concat(d)]||c[d]||m[d]||a;return n?o.createElement(f,i(i({ref:t},u),{},{components:n})):o.createElement(f,i({ref:t},u))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:r,i[1]=l;for(var p=2;p<a;p++)i[p]=n[p];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7887:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>a,metadata:()=>l,toc:()=>p});var o=n(7462),r=(n(7294),n(4137));const a={sidebar_position:1,title:"4. Export and Branch"},i=void 0,l={unversionedId:"prodev-6/step-4",id:"prodev-6/step-4",title:"4. Export and Branch",description:"Working as part of the PrioritZ fusion team you will be configuring GitHub Actions using the Power Platform Build Tools to automate the team\u2019s deployments.",source:"@site/docs/prodev-6/step-4.md",sourceDirName:"prodev-6",slug:"/prodev-6/step-4",permalink:"/Low-Code/docs/prodev-6/step-4",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,title:"4. Export and Branch"},sidebar:"tutorialSidebar",previous:{title:"3. Publish to Azure",permalink:"/Low-Code/docs/prodev-6/step-3"},next:{title:"5. Release to Test",permalink:"/Low-Code/docs/prodev-6/step-5"}},s={},p=[{value:"4.1 Export and branch",id:"41-export-and-branch",level:2}],u={toc:p};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{title:"LAB SCENARIO",type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Working as part of the PrioritZ fusion team you will be configuring GitHub Actions using the Power Platform Build Tools to automate the team\u2019s deployments."),(0,r.kt)("p",{parentName:"admonition"},"In ",(0,r.kt)("strong",{parentName:"p"},"Exercise 3")," you will setup a workflow action, and add steps that will export the solution from dev environment and create a new branch.")),(0,r.kt)("h2",{id:"41-export-and-branch"},"4.1 Export and branch"),(0,r.kt)("p",null,"In this task you will create the workflow definition using the YAML provided. The action YAML uses two space indentation so follow that carefully as you build the workflow definition.  If in doubt, review the indentation shown in the images."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the Actions tab.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click set up a workflow yourself.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Change the file name to it export-and-branch.yml.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add the below YAML snippet. This defines the action trigger and some input parameters that could be changed when manually running the action."))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"on:\n  workflow_dispatch:\n    inputs:\n      #Change this value\n      solution_name:\n        description: 'name of the solution to worked on from Power Platform'\n        required: true\n        default: Prioritz\n       #Do Not change these values\n      solution_exported_folder:\n        description: 'folder name for staging the exported solution *do not change*'\n        required: true\n        default: out/exported/\n      solution_folder:\n        description: 'staging the unpacked solution folder before check-in *do not change*'\n        required: true\n        default: out/solutions/\n      solution_target_folder: \n       description: 'folder name to be created and checked in *do not change*'\n       required: true\n       default: solutions/\n\n")),(0,r.kt)("ol",{start:5},(0,r.kt)("li",{parentName:"ol"},"Setup the workflow. Add the below YAML snippet after the last snippet. This sets up the jobs and identifies the first job as export-from-dev. This also defines the steps with the first one checking out the current main branch content.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"jobs:\n  export-from-dev:\n    runs-on: windows-latest\n    steps:\n    - uses: actions/checkout@v2\n      with:\n        lfs: true\n")),(0,r.kt)("ol",{start:6},(0,r.kt)("li",{parentName:"ol"},"Next you will export both an unmanaged and managed solution file from your dev environment."),(0,r.kt)("li",{parentName:"ol"},"Export the unmanaged solution. Add below snippet after the last snippet.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"name: export-solution action\n      uses: microsoft/powerplatform-actions/export-solution@v0\n      with:\n        environment-url: ${{secrets.PowerPlatformDevUrl}}\n        app-id: ${{secrets.PowerPlatformAppID}}\n        client-secret: ${{ secrets.PowerPlatformClientSecret }}\n        tenant-id: ${{secrets.PowerPlatformTenantID}}\n        solution-name: ${{ github.event.inputs.solution_name }}\n        solution-output-file: ${{ github.event.inputs.solution_exported_folder}}/${{ github.event.inputs.solution_name }}.zip\n")),(0,r.kt)("ol",{start:8},(0,r.kt)("li",{parentName:"ol"},"Export the managed solution. Add below snippet after the last snippet.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: export-managed-solution action\n      uses: microsoft/powerplatform-actions/export-solution@v0\n      with:\n        environment-url: ${{secrets.PowerPlatformDevUrl}}\n        app-id: ${{secrets.PowerPlatformAppID}}\n        client-secret: ${{ secrets.PowerPlatformClientSecret }}\n        tenant-id: ${{secrets.PowerPlatformTenantID}}\n        solution-name: ${{ github.event.inputs.solution_name }}\n        solution-output-file: ${{ github.event.inputs.solution_exported_folder}}/${{ github.event.inputs.solution_name }}_managed.zip\n        managed: true\n")),(0,r.kt)("ol",{start:9},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"The solution files are compressed files and don\u2019t version control well.  Using unpack you will expand the solution files into a set of files that can be easily checked into the repo.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Unpack solution file. Add below snippet after the last snippet."))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"- name: unpack-solution action\n      uses: microsoft/powerplatform-actions/unpack-solution@v0\n      with:\n        solution-file: ${{ github.event.inputs.solution_exported_folder}}/${{ github.event.inputs.solution_name }}.zip\n        solution-folder: ${{ github.event.inputs.solution_folder}}/${{ github.event.inputs.solution_name }}\n        solution-type: 'Both'\n")),(0,r.kt)("ol",{start:11},(0,r.kt)("li",{parentName:"ol"},"Branch and prepare for pull. Add below snippet after the last snippet.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"name: branch-solution, prepare it for a PullRequest\n      uses: microsoft/powerplatform-actions/branch-solution@v0\n      with:\n        solution-folder: ${{ github.event.inputs.solution_folder}}/${{ github.event.inputs.solution_name }}\n        solution-target-folder: ${{ github.event.inputs.solution_target_folder}}/${{ github.event.inputs.solution_name }}\n        repo-token: ${{ secrets.GITHUB_TOKEN }}\n        allow-empty-commit: true\n")),(0,r.kt)("ol",{start:12},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click Start commit and then click Commit new file.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select the Actions tab and select the workflow you created.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click Run workflow.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click Run workflow again and wait for the workflow run to complete."))),(0,r.kt)("ol",{start:16},(0,r.kt)("li",{parentName:"ol"},"Select the Code tab."),(0,r.kt)("li",{parentName:"ol"},"Select Branches. You should see two branches."),(0,r.kt)("li",{parentName:"ol"},"Click to open the branch that was created by the workflow action.")),(0,r.kt)("ol",{start:19},(0,r.kt)("li",{parentName:"ol"},"You should see solution folder.")),(0,r.kt)("ol",{start:20},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click Contribute and select Open pull request.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add description if you like and then click Create pull request.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"You should now see the pull request summary. Confirm that the branch has no conflicts with the main branch and that the changes can be merged into the main branch automatically.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click on the chevron button next to the Merge pull request button and select Squash and merge."))),(0,r.kt)("ol",{start:24},(0,r.kt)("li",{parentName:"ol"},"Click Squash and merge."),(0,r.kt)("li",{parentName:"ol"},"Click Confirm squash and merge."),(0,r.kt)("li",{parentName:"ol"},"The pull request should get merged successfully."),(0,r.kt)("li",{parentName:"ol"},"Do not navigate away from this page.")))}c.isMDXComponent=!0}}]);